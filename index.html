<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Zhanin's Gift Registry</title>
    <link rel="stylesheet" href="main.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Zhanin's Gift Registry</h1>
            <p class="subtitle">Help us welcome our little one with these special gifts</p>
            <div class="header-decoration">
                <span class="decoration-item">üë∂</span>
                <span class="decoration-item">üçº</span>
                <span class="decoration-item">üß∏</span>
                <span class="decoration-item">üë∂</span>
                <span class="decoration-item">üçº</span>
            </div>
        </header>

        <div class="products-grid">
            <!-- Example product card -->
            <div class="product-card" data-id="1">
                <div class="product-image">
                    <img src="images/bb1.jpg" alt="Baby Bottle" />
                </div>
                <button class="buy-button" title="Buy this item">Buy</button>
                <div class="product-content">
                    <h3 class="product-title">Baby Bottle</h3>
                    <p class="product-quantity">Need: 1</p>
                    <a href="https://s.shopee.ph/AUhEEBtz7c" class="shop-button" target="_blank">Shop Now</a>
                </div>
            </div>
            <!-- Repeat product cards similarly, add buy-button to all -->
            <!-- Skipping repeating all for brevity, but you would add the <button class="buy-button">Buy</button> inside each .product-card -->
            <!-- I'll add for all cards in the final script below -->

            <!-- Product 2 -->
            <div class="product-card" data-id="2">
                <div class="product-image">
                    <img src="images/baby2.webp" alt="Baby Bottle" />
                </div>
                <button class="buy-button" title="Buy this item">Buy</button>
                <div class="product-content">
                    <h3 class="product-title">Baby Bottle</h3>
                    <p class="product-quantity">Need: 1</p>
                    <a href="https://s.shopee.ph/7KkCSYsFv8" class="shop-button" target="_blank">Shop Now</a>
                </div>
            </div>

            <!-- Product 3 -->
            <div class="product-card" data-id="3">
                <div class="product-image">
                    <img src="images/chupon.webp" alt="Baby Bottle Set" />
                </div>
                <button class="buy-button" title="Buy this item">Buy</button>
                <div class="product-content">
                    <h3 class="product-title">Baby Bottle Set</h3>
                    <p class="product-quantity">Need:1</p>
                    <a href="https://s.shopee.ph/hBFZTYq3P" class="shop-button" target="_blank">Shop Now</a>
                    </div>
                    </div>
        <!-- Product 4 -->
        <div class="product-card" data-id="4">
            <div class="product-image">
                <img src="images/biberon.webp" alt="Baby Bottle" />
            </div>
            <button class="buy-button" title="Buy this item">Buy</button>
            <div class="product-content">
                <h3 class="product-title">Baby Bottle</h3>
                <p class="product-quantity">Need: 1</p>
                <a href="https://s.shopee.ph/d3V4Xgsvh" class="shop-button" target="_blank">Shop Now</a>
            </div>
        </div>

        <!-- Product 5 -->
        <div class="product-card" data-id="5">
            <div class="product-image">
                <img src="images/bibs.webp" alt="Bibs" />
            </div>
            <button class="buy-button" title="Buy this item">Buy</button>
            <div class="product-content">
                <h3 class="product-title">Bibs</h3>
                <p class="product-quantity">Need: 1</p>
                <a href="https://s.shopee.ph/HCs1OXLUGf" class="shop-button" target="_blank">Shop Now</a>
            </div>
        </div>

        <!-- Product 6 -->
        <div class="product-card" data-id="6">
            <div class="product-image">
                <img src="images/bibs2.webp" alt="Bibs" />
            </div>
            <button class="buy-button" title="Buy this item">Buy</button>
            <div class="product-content">
                <h3 class="product-title">Bibs</h3>
                <p class="product-quantity">Need: 1</p>
                <a href="https://s.shopee.ph/IpCo1J2fQ" class="shop-button" target="_blank">Shop Now</a>
            </div>
        </div>

        <!-- Product 7 -->
        <div class="product-card" data-id="7">
            <div class="product-image">
                <img src="images/bibs3.webp" alt="Bibs" />
            </div>
            <button class="buy-button" title="Buy this item">Buy</button>
            <div class="product-content">
                <h3 class="product-title">Bibs</h3>
                <p class="product-quantity">Need: 1</p>
                <a href="https://s.shopee.ph/AvGZxOJ5Qx" class="shop-button" target="_blank">Shop Now</a>
            </div>
        </div>

        <!-- Product 8 -->
        <div class="product-card" data-id="8">
            <div class="product-image">
                <img src="images/bibs4.webp" alt="Bibs" />
            </div>
            <button class="buy-button" title="Buy this item">Buy</button>
            <div class="product-content">
                <h3 class="product-title">Bibs</h3>
                <p class="product-quantity">Need: 1</p>
                <a href="https://s.shopee.ph/eSk7jNHNQ0" class="shop-button" target="_blank">Shop Now</a>
            </div>
        </div>

        <!-- Product 9 -->
        <div class="product-card" data-id="9">
            <div class="product-image">
                <img src="images/bibs5.webp" alt="Bibs" />
            </div>
            <button class="buy-button" title="Buy this item">Buy</button>
            <div class="product-content">
                <h3 class="product-title">Bibs</h3>
                <p class="product-quantity">Need: 1</p>
                <a href="https://s.shopee.ph/vObSCFY6zL" class="shop-button" target="_blank">Shop Now</a>
            </div>
        </div>
    </div>
</div>

<!-- Confirmation Modal -->
<div class="modal-overlay" id="modalOverlay">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
        <h2 id="modalTitle">Confirm Purchase</h2>
        <p>Are you sure you want to mark this item as purchased?</p>
        <div class="modal-buttons">
            <button class="modal-button yes" id="confirmYes">Yes</button>
            <button class="modal-button no" id="confirmNo">No</button>
        </div>
    </div>
</div>

<!-- Add this script at the bottom inside your <script> tag -->
    <script>
        const modalOverlay = document.getElementById("modalOverlay");
        const confirmYes = document.getElementById("confirmYes");
        const confirmNo = document.getElementById("confirmNo");
    
        let currentCard = null;
        const baseUrl = `https://script.google.com/macros/s/AKfycbyBG4ROOZ6M28fILsq9f0i3f_9wRtv5zOGLFF4DwcUhp_Qu4pEnC5KGFAoc2SstDcRYUA/exec`;
    
        async function fetchItems() {
            try {
                const res = await fetch(baseUrl);
                const data = await res.json();
                return data.items || [];
            } catch (err) {
                console.error(err);
                alert("Failed to fetch items.");
                return [];
            }
        }
    
        async function incrementPurchased(itemId) {
            try {
                const res = await fetch(`${baseUrl}?itemId=${itemId}`);
                return await res.json();
            } catch (err) {
                console.error(err);
                alert('Error: ' + err.message);
                return null;
            }
        }
    
        function renderItemCard(item) {
            const purchased = Number(item.Purchased);
            const needed = Number(item.Needed);
            const remaining = Math.max(needed - purchased, 0);
            const disabled = purchased >= needed ? "purchased" : "";
    
            return `
                <div class="product-card ${disabled}" data-id="${item.ID}">
                    <div class="product-image">
                        <img src="${item.Image || 'images/placeholder.jpg'}" alt="${item.Name}" />
                    </div>
                    <button class="buy-button" title="Buy this item" ${disabled ? "disabled" : ""}>Buy</button>
                    <div class="product-content">
                        <h3 class="product-title">${item.Name}</h3>
                        <p class="product-quantity">Need: ${remaining}</p>
                        <a href="${item.Link}" class="shop-button" target="_blank">Shop Now</a>
                    </div>
                </div>
            `;
        }
    
        async function initialize() {
            const grid = document.querySelector(".products-grid");
            const items = await fetchItems();
    
            if (!items.length) {
                grid.innerHTML = "<p>No items found.</p>";
                return;
            }
    
            grid.innerHTML = items.map(renderItemCard).join("");
    
            document.querySelectorAll(".buy-button").forEach(button => {
                button.addEventListener("click", (e) => {
                    e.preventDefault();
                    const card = e.target.closest(".product-card");
                    if (!card || card.classList.contains("purchased")) return;
    
                    currentCard = card;
                    modalOverlay.style.display = "flex";
                });
            });
        }
    
        confirmYes.addEventListener("click", async () => {
            if (!currentCard) return;
    
            const id = currentCard.dataset.id;
            const result = await incrementPurchased(id);
    
            if (result && result.status === "success") {
                await initialize(); // Re-render all cards
            } else {
                alert("Could not update purchase. Try again later.");
            }
    
            modalOverlay.style.display = "none";
            currentCard = null;
        });
    
        confirmNo.addEventListener("click", () => {
            modalOverlay.style.display = "none";
            currentCard = null;
        });
    
        modalOverlay.addEventListener("click", (e) => {
            if (e.target === modalOverlay) {
                modalOverlay.style.display = "none";
                currentCard = null;
            }
        });
    
        document.addEventListener("DOMContentLoaded", initialize);
    </script>
    
    
        
</body> </html>